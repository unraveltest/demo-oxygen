
<!DOCTYPE html
  PUBLIC "" "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:whc="http://www.oxygenxml.com/webhelp/components" xml:lang="en-us" lang="en-us">
    <head><link rel="shortcut icon" href="favicon32x32.png"><!----></link><link rel="icon" href="favicon32x32.png"><!----></link><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Unravel 4.0-4.1 Unravel 4.0-4.1 Installation Guide for Amazon Elastic MapReduce (Amazon EMR) and Qubole Clusters Introduction Unravel Sensor can collect information about Spark applications. This ..." /><meta charset="UTF-8" /><meta name="copyright" content="(C) Copyright 2019" /><meta name="DC.rights.owner" content="(C) Copyright 2019" /><meta name="DC.Type" content="task" /><meta name="DC.Relation" scheme="URI" content="50688627.html" /><meta name="DC.Relation" scheme="URI" content="50689789.html" /><meta name="DC.Relation" scheme="URI" content="50876309.html" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="FCFGHGGB" /><meta name="DC.Language" content="en-us" /><title>Part 3: Install Unravel Spark Sensor on New or Existing Qubole Spark Cluster</title><!--  Generated with Oxygen version 20.1-SNAPSHOT, build number 2018122203.  --><meta name="wh-path2root" content="" /><meta name="wh-toc-id" content="FCFGHGGB-d66e119" /><link rel="stylesheet" type="text/css" href="./oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css" /><link rel="stylesheet" href="./oxygen-webhelp/lib/bootstrap/css/bootstrap-theme.min.css" /><link rel="stylesheet" href="./oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css" /><link rel="stylesheet" type="text/css" href="./oxygen-webhelp/app/topic-page.css?buildId=2018122203" /><script type="text/javascript" src="./oxygen-webhelp/lib/jquery/jquery-3.1.1.min.js"><!----></script><script data-main="./oxygen-webhelp/app/topic-page.js" src="./oxygen-webhelp/lib/requirejs/require.js"></script><link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/green.css?buildId=2018122203" /></head>

    <body id="FCFGHGGB" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">Jump to main content</a>
        <!-- EXM-36950 - Expand the args.hdr parameter here -->
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div class="wh_header_flex_container">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <!--
                            This component will be generated when the next parameters are specified in the transformation scenario:
                            'webhelp.logo.image' and 'webhelp.logo.image.target.url'.
                            See: http://oxygenxml.com/doc/versions/17.1/ug-editor/#topics/dita_webhelp_output.html.
                    -->
                    <a href="https://unraveldata.com/" class=" wh_logo hidden-xs "><img src="unravel-logo-white-small-1.png" alt="  Unravel 4.0-4.1  " /></a>
                    <div class=" wh_publication_title "><a href="index.html"><span class="booktitle">  <span class="ph mainbooktitle">Unravel 4.0-4.1</span>  </span></a></div>
                    
                </div>
                
                <!-- The menu button for mobile devices is copied in the output only when the 'webhelp.show.top.menu' parameter is set to 'yes' -->
                <button type="button" data-target="#wh_top_menu_and_indexterms_link" id="wh_menu_mobile_button" data-toggle="collapse" class="navbar-toggle collapsed wh_toggle_button" aria-expanded="false" aria-label="Toggle menu">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                <nav class=" wh_top_menu "><ul>
   <li><span data-tocid="Overview_53899450-d66e14" data-state="leaf" class=" topicref " data-id="Overview_53899450"><span class="title"><a href="Overview_53899450.html">Overview </a></span></span></li>
   <li class="has-children"><span data-tocid="installation-d66e23" data-state="not-ready" class=" topicref " data-id="installation"><span class="title"><a href="installation.html">Installation Guides</a></span></span></li>
   <li class="has-children"><span data-tocid="User-Guide_50687944-d66e176" data-state="not-ready" class=" topicref " data-id="User-Guide_50687944"><span class="title"><a href="User-Guide_50687944.html">User Guide </a></span></span></li>
   <li><span data-tocid="Unravel-Server-Reference_50690507-d66e260" data-state="leaf" class=" topicref " data-id="Unravel-Server-Reference_50690507"><span class="title"><a href="Unravel-Server-Reference_50690507.html">Unravel Server Reference </a></span></span></li>
   <li class="has-children"><span data-tocid="Advanced-Topics_50688158-d66e270" data-state="not-ready" class=" topicref " data-id="Advanced-Topics_50688158"><span class="title"><a href="Advanced-Topics_50688158.html">Advanced Topics </a></span></span></li>
   <li><span data-tocid="tocId-d66e479" data-state="leaf" class=" topicref "><span class="title"><a href="53900010.html">***</a></span></span></li>
</ul></nav>
                
                
            </div>
        </div>
    </div>
</header>
        
        <div class=" wh_search_input "><form id="searchForm" method="get" role="search" action="search.html"><div><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" /><button type="submit" class="wh_search_button" aria-label="Search"><span>Search</span></button></div><script><!--
                                    $(document).ready(function () {
                                        $('#searchForm').submit(function (e) {
                                            if ($('.wh_search_textfield').val().length < 1) {
                                                e.preventDefault();
                                            }
                                        });
                                    });
                                --></script></form></div>
        
        <div class="container-fluid">
            <div class="row">

                <nav class="wh_tools hidden-print">
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol xmlns:html="http://www.w3.org/1999/xhtml" class="hidden-print"><li><span class="home"><a href="index.html"><span>Home</span></a></span></li>
   <li><span class="topicref" data-id="installation"><span class="title"><a href="installation.html">Installation Guides</a></span></span></li>
   <li><span class="topicref" data-id="FAGIIGCH"><span class="title"><a href="50688627.html">Installation Guide for Amazon Elastic MapReduce (Amazon EMR) and Qubole Clusters </a></span></span></li>
   <li class="active"><span class="topicref" data-id="FCFGHGGB"><span class="title"><a href="52567661.html">Part 3: Install Unravel Spark Sensor on New or Existing Qubole Spark Cluster </a></span></span></li>
</ol></div>

                    <div class="wh_right_tools hidden-sm hidden-xs">
                        <div class=" wh_navigation_links "><span id="topic_navigation_links" class="navheader">
  
<span class="navprev"><a class="link" href="50689789.html" title="Part 2: Install Unravel Hive Sensor on Qubole Hadoop2/Hive Cluster" aria-label="Previous topic: Part 2: Install Unravel Hive Sensor on Qubole Hadoop2/Hive Cluster" rel="prev"></a></span>  
<span class="navnext"><a class="link" href="50876309.html" title="Part 4: Modify Amazon EMR Cluster Bootstrap/Setup" aria-label="Next topic: Part 4: Modify Amazon EMR Cluster Bootstrap/Setup" rel="next"></a></span>  </span></div>
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="Collapse sections" title="Collapse sections"></button>
                        <div class=" wh_print_link print "><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div>
                    </div>
                </nav>
            </div>

            <div class="wh_content_area">
                <div class="row">
                    
                        <nav role="navigation" id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-3 hidden-xs navbar hidden-print">
                            <div class=" wh_publication_toc " data-tooltip-position="right"><ul role="tree" aria-label="Table of Contents"><span class="expand-button-action-labels"><span id="button-expand-action" aria-label="Expand"></span><span id="button-collapse-action" aria-label="Collapse"></span><span id="button-pending-action" aria-label="Pending"></span></span><li role="treeitem" aria-expanded="true"><span data-tocid="installation-d66e23" class="topicref" data-id="installation" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action installation-d66e23-link" class="wh-expand-btn"></span><span class="title"><a href="installation.html" id="installation-d66e23-link">Installation Guides</a></span></span><ul role="group" class="nav nav-list"><span class="expand-button-action-labels"><span id="button-expand-action" aria-label="Expand"></span><span id="button-collapse-action" aria-label="Collapse"></span><span id="button-pending-action" aria-label="Pending"></span></span><li role="treeitem" aria-expanded="false"><span data-tocid="FAGIICFE-d66e31" class="topicref" data-id="FAGIICFE" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action FAGIICFE-d66e31-link" class="wh-expand-btn"></span><span class="title"><a href="50688254.html" id="FAGIICFE-d66e31-link">Installation Guide for Cloudera Distribution Including Apache Hadoop (CDH), with Cloudera Manager (CM) </a></span></span></li>
         <li role="treeitem" aria-expanded="false"><span data-tocid="Installation-Guide-for-MapR_50961894-d66e63" class="topicref" data-id="Installation-Guide-for-MapR_50961894" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action Installation-Guide-for-MapR_50961894-d66e63-link" class="wh-expand-btn"></span><span class="title"><a href="Installation-Guide-for-MapR_50961894.html" id="Installation-Guide-for-MapR_50961894-d66e63-link">Installation Guide for MapR </a></span></span></li>
         <li role="treeitem" aria-expanded="true"><span data-tocid="FAGIIGCH-d66e95" class="topicref" data-id="FAGIIGCH" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action FAGIIGCH-d66e95-link" class="wh-expand-btn"></span><span class="title"><a href="50688627.html" id="FAGIIGCH-d66e95-link">Installation Guide for Amazon Elastic MapReduce (Amazon EMR) and Qubole Clusters </a></span></span><ul role="group" class="nav nav-list"><span class="expand-button-action-labels"><span id="button-expand-action" aria-label="Expand"></span><span id="button-collapse-action" aria-label="Collapse"></span><span id="button-pending-action" aria-label="Pending"></span></span><li role="treeitem"><span data-tocid="FAGIJGBB-d66e103" class="topicref" data-id="FAGIJGBB" data-state="leaf"><span role="button" class="wh-expand-btn"></span><span class="title"><a href="50689611.html" id="FAGIJGBB-d66e103-link">Part 1: Install Unravel Server for Amazon EMR or Qubole Cluster </a></span></span></li>
               <li role="treeitem"><span data-tocid="FAGIJHIJ-d66e111" class="topicref" data-id="FAGIJHIJ" data-state="leaf"><span role="button" class="wh-expand-btn"></span><span class="title"><a href="50689789.html" id="FAGIJHIJ-d66e111-link">Part 2: Install Unravel Hive Sensor on Qubole Hadoop2/Hive Cluster </a></span></span></li>
               <li role="treeitem" class="active"><span data-tocid="FCFGHGGB-d66e119" class="topicref" data-id="FCFGHGGB" data-state="leaf"><span role="button" class="wh-expand-btn"></span><span class="title"><a href="52567661.html" id="FCFGHGGB-d66e119-link">Part 3: Install Unravel Spark Sensor on New or Existing Qubole Spark Cluster </a></span></span></li>
               <li role="treeitem"><span data-tocid="FAIHGDAJ-d66e127" class="topicref" data-id="FAIHGDAJ" data-state="leaf"><span role="button" class="wh-expand-btn"></span><span class="title"><a href="50876309.html" id="FAIHGDAJ-d66e127-link">Part 4: Modify Amazon EMR Cluster Bootstrap/Setup </a></span></span></li>
               <li role="treeitem"><span data-tocid="FBCBDBDB-d66e135" class="topicref" data-id="FBCBDBDB" data-state="leaf"><span role="button" class="wh-expand-btn"></span><span class="title"><a href="51213131.html" id="FBCBDBDB-d66e135-link">Part 5: Additional Topics for EMR or Qubole </a></span></span></li>
            </ul>
         </li>
         <li role="treeitem" aria-expanded="false"><span data-tocid="FAGIIEED-d66e143" class="topicref" data-id="FAGIIEED" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action FAGIIEED-d66e143-link" class="wh-expand-btn"></span><span class="title"><a href="50688443.html" id="FAGIIEED-d66e143-link">Installation Guide for Hortonworks Data Platform (HDP) </a></span></span></li>
      </ul>
   </li>
</ul></div>
                        </nav>
                    
                    
                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12" id="wh_topic_body">
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="ariaid-title1">
   <h1 class="title topictitle1" id="ariaid-title1">Part 3: Install Unravel Spark Sensor on New or Existing Qubole Spark
      Cluster </h1>
   <div class="body taskbody">
      <section class="section context">
         <ol class="ol">

            <li class="li first">
               <span class="ph">
                  <a class="xref" href="index.html">Unravel 4.0-4.1</a>
               </span>
            </li>

            <li class="li">
               <span class="ph">
                  <a class="xref" href="Unravel-4.0-4.1_50672724.html">Unravel 4.0-4.1</a>
               </span>
            </li>

            <li class="li">
               <span class="ph">
                  <a class="xref" href="50688627.html">Installation Guide for Amazon Elastic MapReduce (Amazon
                     EMR) and Qubole Clusters</a>
               </span>
            </li>

         </ol>
         <p class="p">Introduction</p>
         <p class="p">Unravel Sensor can collect information about Spark applications. This guide describes
            how to install Unravel Sensor for Qubole-based Spark clusters. The information here
            applies to Spark versions 1.5.x through 2.0.x and Unravel 3.4-4.1. Highlighted text
            indicates where you must substitute your particular values.</p>
         <span class="ph aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
         <p class="p">
            <span class="ph">
               <code class="ph codeph">HIGHLIGHTED</code>
            </span> text and text with brackets ( { } ), unless otherwise noted, indicates where you
            must substitute your particular values for the text.</p>
         <p class="p">
            <span class="ph">
               <code class="ph codeph">UNRAVEL_HOST_IP</code>
            </span>must be a fully qualified DNS or the IP address.</p>
         <p class="p">
            <span class="ph">
               <span class="ph">
                  <span class="ph">
                     <span class="ph">
                        <span class="ph">
                           <code class="ph codeph">PATH_TO_SENSOR_JARS</code>
                        </span>
                     </span>
                  </span>
               </span>
            </span>: <span class="ph">
               <span class="ph">is the absolute path to the location of the sensor jars.</span>
            </span>
         </p>
         <p class="p">
            <span class="ph"> </span>
            <span class="ph"></span>
         </p>
         <p class="p">Add Unravel Spark Instrumentation to New Qubole Spark Cluster</p>
         <ol class="ol">

            <li class="li">
               <p class="p">
                  <span class="ph confluence-anchor-link"></span>Configure<strong class="ph b"> </strong>Unravel s3 read-only
                  credentials in <code class="ph codeph">/usr/local/unravel/etc/s3ro.properties</code> as
                  follows:</p>
               <span class="ph aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
               <p class="p">This sample <code class="ph codeph">s3ro.properties</code> file has multiple s3 profiles and
                  access keys.</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>[default]
aws_access_key_id = {ACCESS_KEY_VALUE1}
aws_secret_access_key = {SECRET_KEY_VALUE1}

[profile_name_2]
aws_access_key_id = {ACCESS_KEY_VALUE2}
aws_secret_access_key = {SECRET_KEY_VALUE2}</code></pre>
               <p class="p auto-cursor-target">
                  <em class="ph i">Note: Substitute actual values for ACCESS_KEY_VALUEx and SECRET_KEY_VALUEx.</em>
               </p>
               <p class="p"></p>
            </li>

            <li class="li">
               <p class="p">Edit <code class="ph codeph">/usr/local/unravel/etc/unravel.properties</code> so that Unravel
                  Server incorporates <code class="ph codeph">s3ro.properties</code>:</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>com.unraveldata.s3.profile.config.file.path=/usr/local/unravel/etc/s3ro.properties
com.unraveldata.spark.s3.profilesToBuckets=&lt;default&gt;:&lt;s3ro_bucket1&gt;,&lt;profile_name_2&gt;:&lt;s3r0_bucket2&gt;</code></pre>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Restart the Unravel ETL daemon(s):</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code># sudo /etc/init.d/unravel_all.sh stop-etl
# sudo /etc/init.d/unravel_all.sh start</code></pre>
            </li>

            <li class="li">Ensure ports 3000 (for web UI access) and 4043 (from cluster) are open for incoming
               traffic. These should <strong class="ph b">not</strong> be open to the public
               Internet.
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Verify that port 3000 is open by running a
                     <code class="ph codeph">curl</code> command from a potential Unravel user machine as follows
                  :</p>
               <span class="ph aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
               <p class="p">If the version information is not visible (request timeout), then adjust security
                  groups, firewalls, etc. and try again. For VPCs, it might be necessary to add a
                  route.</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code># curl http://{UNRAVEL_HOST_IP}:3000/version.txt</code></pre>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Copy the Unravel Spark bootstrap file from
                  Unravel Server to your Spark Qubole cluster, using <code class="ph codeph">curl</code>:</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code># curl http://{UNRAVEL_HOST_IP}:3000/hh/unraveldata-clients/unravel_qubole_bootstrap.sh &gt; unravel_qubole_bootstrap.sh</code></pre>
               <p class="p auto-cursor-target">
                  <em class="ph i">Note: Substitute the actual host for UNRAVEL_HOST_IP.</em>
               </p>
               <p class="p auto-cursor-target">
                  <em class="ph i"></em>
               </p>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Copy Unravel Spark bootstrap file to your s3://<span class="ph">
                     <span class="ph">
                        <code class="ph codeph">Bootstrap_location_for_Spark Qubole Cluster</code>
                     </span>
                  </span>
               </p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>aws s3 cp unravel_qubole_bootstrap.sh s3://{Bootstrap_location_for_Spark Qubole cluster}/unravel_qubole_bootstrap.sh</code></pre>
            </li>

            <li class="li">In Qubole’s <strong class="ph b">Edit Cluster Setting</strong>, if you <u class="ph u">
                  <strong class="ph b">do not</strong>
               </u> have your own customized Node Bootstrap file, add
                  <code class="ph codeph">unravel_qubole_bootstrap.sh</code> into this field as shown in the diagram:
               <span class="ph confluence-embedded-file-wrapper confluence-embedded-manual-size">
                  <img class="image confluence-embedded-image confluence-content-image-border" src="media/52620138.png" />
               </span>
            </li>

            <li class="li">In Qubole, scripts do not take input parameters. Therefore, Unravel's bootstrap
               script takes all the required parameters from the Hadoop configuration. You can
               customize your Hadoop configuration through specific parameters within the
                  <strong class="ph b">Override Hadoop Configuration Variables</strong> section as shown in the diagram
               below. As you can see, <strong class="ph b">unravel-bootstrap </strong>is the property name you must use
               prepend to all configuration parameters relevant to Unravel. 
               <em class="ph i">Note: Separate parameters with commas.</em>
               <span class="ph confluence-embedded-file-wrapper confluence-embedded-manual-size">
                  <img class="image confluence-embedded-image confluence-content-image-border" src="media/52620160.png" />
               </span>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Add these settings
                     to <code class="ph codeph">unravel-bootstrap</code> for Spark clusters:</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>unravel-bootstrap=UNRAVEL_SERVER=UNRAVEL_HOST_AND_PORT, SPARK_VER_XYZ=SPARK_VER_XYZ[,SPARK_APP_LOAD_MODE=SPARK_APP_LOAD_MODE,WRAPPED_SCRIPT=WRAPPED_SCRIPT]</code></pre>
               <p class="p">
                  <span class="ph">
                     <code class="ph codeph">
                        <span class="ph">
                           <span class="ph">
                              <span class="ph">
                                 <span class="ph">
                                    <span class="ph">
                                       <code class="ph codeph">
                                          <span class="ph">SPARK_VERSION<span class="ph">
                                                <span class="ph">
                                                  <code class="ph codeph">_X.Y.Z</code>
                                                </span>
                                             </span>
                                          </span>
                                       </code>
                                    </span>
                                    <span class="ph">
                                       <span class="ph"> - target Spark version (eg. 1.3.0, 1.6.0, 2.0.1,
                                          etc.)</span>
                                    </span>
                                 </span>
                              </span>
                           </span>
                        </span>
                     </code>
                  </span>
               </p>
               <p class="p title">Note:</p>
               <p class="p">
                  <span class="ph">
                     <code class="ph codeph">The parameters in square brackets [ ] above are optional. Their
                        meanings are:</code>
                  </span>
               </p>
               <p class="p">
                  <span class="ph">
                     <code class="ph codeph">SPARK_APP_LOAD_MODE </code>
                  </span>is either OPS or DEV mode, and if not explicitly specified defaults to OPS
                  mode. For details on application loading modes, see <a class="xref" href="#FCFGHGGB__Part3:InstallUnravelSparkSensoronNeworExistingQuboleSparkCluster-Appendix">Appendix</a>.</p>
               <p class="p">
                  <span class="ph">
                     <span class="ph">
                        <span class="ph">
                           <span class="ph">
                              <span class="ph">
                                 <span class="ph">
                                    <code class="ph codeph">
                                       <span class="ph">WRAPPED_SCRIPT</span>
                                    </code>
                                 </span>
                              </span>
                           </span>
                        </span>
                     </span>
                  </span> is the full S3 path to your original bootstrap script. Your bootstrap script
                  is invoked from <span class="ph">
                     <code class="ph codeph">unravel_qubole_bootstrap.sh</code>
                  </span>.</p>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Confirm that the <code class="ph codeph">unravel_es</code>
                  service is installed:</p>
               <ol class="ol" type="a">

                  <li class="li">
                     <p class="p auto-cursor-target">Open an SSH session to the Qubole master
                        node.</p>
                  </li>

                  <li class="li">
                     <p class="p auto-cursor-target">Run this command to check that the
                        unravel_es service has been started:</p>
                     <pre class="pre codeblock syntaxhighlighter-pre"><code># ps -aux | grep unravel_es</code></pre>
                  </li>

               </ol>
            </li>

         </ol>
         <p class="p">(Optional) Add Unravel Spark Instrumentation to an Existing Qubole Spark Cluster</p>
         <ol class="ol">

            <li class="li">Ensure that you have configured s3 read-only credentials
                  in <code class="ph codeph">/usr/local/unravel/etc/s3ro.properties</code> for Unravel, as
               described in <a class="xref" href="#FCFGHGGB__Part3:InstallUnravelSparkSensoronNeworExistingQuboleSparkCluster-configure_s3ro">steps 1 and 2 above</a>.</li>

            <li class="li">
               <p class="p">Obtain following essential Spark version files from Unravel Server:</p>
               <ol class="ol" type="a">

                  <li class="li">
                     <p class="p">To obtain Spark version 1.6.x zip file:</p>
                     <pre class="pre codeblock syntaxhighlighter-pre"><code># wget http://{UNRAVEL_HOST_IP}:3000/hh/unravel-sensor-for-spark-bin-1.6.zip
</code></pre>
                  </li>

                  <li class="li">
                     <p class="p">To obtain Spark version 2.0.x zip file:</p>
                     <pre class="pre codeblock syntaxhighlighter-pre"><code># wget http://{UNRAVEL_HOST_IP}:3000/hh/unravel-sensor-for-spark-bin-2.0.zip</code></pre>
                     <span class="ph aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
                     <p class="p">
                        <span class="ph">Unzip the archive </span>
                        <code class="ph codeph">
                           <span class="ph">unravel-sensor-for-spark-bin-1.6.zip</span>
                        </code>
                        <span class="ph"> and ensure via the bootstrap action that the included jars are deployed
                           on Qubole nodes at <span class="ph">
                              <span class="ph">
                                 <span class="ph">
                                    <code class="ph codeph">PATH_TO_SENSOR_JARS</code>
                                 </span>
                              </span>
                           </span>
                        </span>
                        <span class="ph"> </span>
                        <span class="ph">which is used in the configuration settings outlined in step 4. </span>
                     </p>
                  </li>

               </ol>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">
                  <span class="ph">
                     <span class="ph">Obtain EMR jar files and snippet script that should be added to the
                        bootstrap action to start the unravel_es process:</span>
                  </span>
                  <span class="ph">
                     <span class="ph">
                        <span class="ph"></span>
                     </span>
                  </span>
               </p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>
#wget http://{UNRAVEL_HOST_IP}:3000/hh/unraveldata-clients/snippets/run-es.sh
#wget http://{UNRAVEL_HOST_IP}:3000/hh/unravel-emr-sensor.jar
</code></pre>
               <span class="ph aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
               <p class="p">
                  <span class="ph">Ensure that <code class="ph codeph">unravel-emr-sensor.jar</code>
                  </span>
                  <span class="ph"> is deployed on the Qubole nodes via the bootstrap action. Preferably, deploy <span class="ph">
                        <code class="ph codeph">unravel-emr-sensor.jar</code>
                     </span>
                  </span>
                  <span class="ph">at the same path of <span class="ph">
                        <span class="ph">
                           <span class="ph">
                              <span class="ph">
                                 <code class="ph codeph">PATH_TO_SENSOR_JARS</code>
                              </span>
                           </span>
                        </span>
                     </span>
                  </span>
                  <span class="ph"> </span>
                  <span class="ph">as used above.</span>
               </p>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Edit <code class="ph codeph">run-es.sh</code> snippet script to
                  customize following two parameters to fit into your Qubole Spark environment:</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code># Replace following two parameters into your Qubole Spark environment #
UNRAVEL_HOST={UNRAVEL_HOST_IP}
UNRAVEL_EMR_SENSOR_JAR={PATH_TO_SENSOR_JARS}</code></pre>
               <p class="p auto-cursor-target">
                  <em class="ph i"></em>
               </p>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">
                  <span class="ph">
                     <span class="ph">Spark configuration can be provided in the </span>
                     <span class="ph">Qubole console</span>
                     <span class="ph"> at bootstrap or directly inside </span>
                     <span class="ph">
                        <span class="ph">
                           <code class="ph codeph">spark-defaults.conf</code>
                        </span>
                     </span>
                     <span class="ph"> configuration file, if the cluster is already started. </span>
                  </span>
               </p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>spark.unravel.server.hostport {UNRAVEL_HOST_IP}:4043
spark.driver.extraJavaOptions -javaagent:{PATH_TO_SENSOR_JARS}/btrace-agent.jar=bootClassPath={PATH_TO_SENSOR_JARS}/unravel-boot.jar,systemClassPath=&lt;PATH_TO_SENSOR_JARS&gt;/unravel-sys.jar,script=DriverProbe.class:SQLProbe.class -Dcom.sun.btrace.FileClient.flush=-1
spark.executor.extraJavaOptions -javaagent:{PATH_TO_SENSOR_JARS}/btrace-agent.jar=bootClassPath={PATH_TO_SENSOR_JARS}/unravel-boot.jar,systemClassPath={PATH_TO_SENSOR_JARS}/unravel-sys.jar,script=ExecutorProbe.class -Dcom.sun.btrace.FileClient.flush=-1</code></pre>
            </li>

            <li class="li">
               <p class="p auto-cursor-target">Edit <code class="ph codeph">zeppelin-env.sh</code> by
                  appending the following values to <code class="ph codeph">ZEPPELIN_JAVA_OPTS</code> as
                  follows:</p>
               <pre class="pre codeblock syntaxhighlighter-pre"><code>export ZEPPELIN_JAVA_OPTS="-Dcom.sun.btrace.FileClient.flush=-1 -javaagent:{PATH_TO_SENSOR_JARS}/btrace-agent.jar=bootClassPath={PATH_TO_SENSOR_JARS}/unravel-boot.jar,systemClassPath={PATH_TO_SENSOR_JARS}/unravel-sys.jar,script=DriverProbe.class:SQLProbe.class"</code></pre>
               <p class="p auto-cursor-target">
                  <em class="ph i"></em>
               </p>
               <span class="ph aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
               <p class="p">The Zeppelin configuration is located at
                     <code class="ph codeph">/usr/lib/zeppelin/conf/zeppelin-env.sh</code>.</p>
            </li>

         </ol>
         <p class="p"></p>
         <p class="p">
            <span class="ph confluence-anchor-link"></span>Appendix</p>
         <p class="p">
            <strong class="ph b">Application Loading Modes for Spark Applications: OPS, DEV, and BATCH</strong>
         </p>
         <p class="p">There are three modes in which Spark applications can be loaded into Unravel Web UI:</p>
         <ul class="ul">

            <li class="li">OPS mode shows applications in the UI after the application is done.</li>

            <li class="li">DEV mode shows applications in the UI as soon as the first job of the Spark
               application completes.</li>

            <li class="li">BATCH mode loads applications for which the sensor was not enabled at the time the
               application has been run.  <span class="ph">
                  <span class="ph"> </span>
               </span>
            </li>

         </ul>
         <p class="p">You can specify the application load mode for the bootstrap script by setting
               <code class="ph codeph">SPARK_APP_LOAD_MODE</code> to <code class="ph codeph">OPS</code> or <code class="ph codeph">DEV</code>.
            By default, if not explicitly specified, <code class="ph codeph">SPARK_APP_LOAD_MODE</code> is
               <code class="ph codeph">OPS</code>. All three modes can coexist in the same Unravel Server. For
            example, all Spark applications from Qubole cluster A can be loaded in OPS mode, all
            Spark applications from Qubole cluster B can be loaded in DEV mode, and all Spark
            applications from Qubole cluster C can be loaded in BATCH mode.</p>
         <p class="p">
            <strong class="ph b">When to Use Which Mode</strong>
         </p>
         <ul class="ul">

            <li class="li">
               <p class="p">Unravel recommends using OPS mode as the cluster-side default for all Qubole
                  clusters. The OPS mode has been rigorously benchmarked to have less than 1.3% CPU
                  and memory overhead. Both the OPS and DEV modes use the Unravel Spark sensor,
                  which is enabled via modifications to <span class="ph">
                     <code class="ph codeph">spark.driver.extraJavaOptions</code>.</span> The key difference is that
                  OPS mode sets <code class="ph codeph">
                     <span class="ph">-Dcom.unraveldata.spark.sensor.disableLiveUpdates=true</span>
                  </code> while DEV mode sets<span class="ph">
                     <code class="ph codeph"> -Dcom.unraveldata.spark.sensor.disableLiveUpdates=false</code>
                     (false is the default).</span>
               </p>
            </li>

         </ul>
         <ul class="ul">

            <li class="li">
               <p class="p">DEV mode is useful during Spark application development. This mode shows a Spark
                  application as soon as the first Spark job of the application finishes. For long
                  running applications, this functionality is useful, as the application is shown in
                  the UI while the application is running. In addition, DEV mode shows applications
                  even when the Spark event log is not being persisted to HDFS or S3. This is an
                  advantage in situations like Spark on Mesos.</p>
            </li>

         </ul>
         <ul class="ul">

            <li class="li">
               <p class="p">In a Qubole cluster that is using OPS mode as the default, DEV mode can be
                  obtained for individual Spark applications by overriding <span class="ph">
                     <code class="ph codeph">spark.driver.extraJavaOptions</code> to include
                        <code class="ph codeph">-Dcom.unraveldata.spark.sensor.disableLiveUpdates=false</code>.</span>
               </p>
            </li>

         </ul>
         <ul class="ul">

            <li class="li">
               <p class="p">BATCH mode is always on and does not interfere with application performance in any
                  way since the loading is entirely outside the application execution path. For
                  details see the next section.</p>
            </li>

         </ul>
         <p class="p"></p>
         <p class="p">
            <strong class="ph b">Loading Applications in Batch Mode</strong>
         </p>
         <p class="p">In order to load Spark apps in BATCH mode, Unravel Server must pull the Spark event log
            file either from S3 or from HDFS. The data collected in the UI is less detailed than
            when  Unravel Sensor is enabled (for instance, detailed resource usage metrics are
            unavailable). The BATCH mode of operation is helpful to load all of the applications
            that have been run in the past, before Unravel Sensor was installed. To enable the batch
            mode, add the following property to
               <code class="ph codeph">/usr/local/unravel/etc/unravel.properties</code> and restart the Spark
            worker daemon(s) as listed earlier:</p>
         <pre class="pre codeblock syntaxhighlighter-pre"><code>com.unraveldata.spark.eventlog.location=hdfs://NAMENODE_IP_PORT/user/spark/applicationHistory/</code></pre>
         <p class="p"></p>
         <p class="p title">Note:</p>
         <span class="ph aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
         <p class="p">Currently, only one event log location is supported.</p>
         <p class="p">
            <em class="ph i auto-cursor-target"></em>
         </p>
         <p class="p"></p>
         <p class="p"></p>
         <p class="p"></p>
         <p class="p"></p>
         <p class="p"></p>
         <p class="p">Attachments:</p>
         <img class="image" src="images/icons/bullet_blue.gif" alt="" />
         <a class="xref" href="media/52567665.png">logo_small.png</a> (image/png) 
         <br /><img class="image" src="images/icons/bullet_blue.gif" alt="" /><br />
         <a class="xref" href="media/52567668.png">worddav95f1e8fd13958fae391afc8e6f9ad03d.png</a> (image/png) 
         <br /><img class="image" src="images/icons/bullet_blue.gif" alt="" /><br />
         <a class="xref" href="media/52620090.png">image2017-6-2_19-21-20.png</a> (image/png) 
         <br /><img class="image" src="images/icons/bullet_blue.gif" alt="" /><br />
         <a class="xref" href="media/52620138.png">hadoop_cluster_settings1.png</a>
         (image/png) 
         <br /><img class="image" src="images/icons/bullet_blue.gif" alt="" /><br />
         <a class="xref" href="media/52620160.png">hadoop_cluster_settings2.png</a>
         (image/png) 
      </section>
   </div>
</article></main></div>
                        
                        
                        <!--
    
Oxygen WebHelp Plugin
Copyright (c) 1998-2018 Syncro Soft SRL, Romania.  All rights reserved.

--><div id="wh_feedback">
    <div id="cmts"><!----></div>
    
    <script type="text/javascript" src="./oxygen-webhelp/feedback/config/config.js"><!----></script>
    <script type="text/javascript" src="./oxygen-webhelp/feedback/resources/js/parseuri.js"><!----></script>
    <script type="text/javascript" src="./oxygen-webhelp/feedback/resources/localization/strings.js"><!----></script>
    <script type="text/javascript" src="./oxygen-webhelp/feedback/resources/js/init.js"><!----></script>
    <script type="text/javascript">
        function showCommentsFor(page) {
           console.log('showCommentsFor(' + page + ')');
           init(page, $('#cmts'));
           
           return false;
        }
        
        var pageLocation = window.location.href;
        try {
            var p = parseUri(pageLocation);
            console.log(p);
            showCommentsFor(p.path);
        } catch (e) {
            debug(e);
        }
    </script>
</div>
                    </div>
                    
                </div>
            </div>
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container text-center ">
    Generated by <a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank">&lt;oXygen/&gt; XML WebHelp</a> - Trial Edition
  </div>
</footer>
        
        <div id="go2top">
            <span class="glyphicon glyphicon-chevron-up"></span>
        </div>
        
        <!-- The modal container for images -->
        <div id="modal_img_large" class="modal">
            <span class="close glyphicon glyphicon-remove"></span>
            <!-- Modal Content (The Image) -->
            <img class="modal-content" id="modal-img" />
            <!-- Modal Caption (Image Text) -->
            <div id="caption"></div>
        </div>
        
        <script src="./oxygen-webhelp/lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        
    </body>
</html>